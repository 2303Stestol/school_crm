{% extends "crm/base.html" %}
{% block title %}Создание курса{% endblock %}
{% block extra_head %}
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const startField = document.querySelector('#id_start_date');
      const endField = document.querySelector('#id_end_date');
      if (!startField || !endField) {
        return;
      }
      const syncEndDate = function () {
        if (!startField.value || endField.dataset.userEdited === '1') {
          return;
        }
        const start = new Date(startField.value);
        if (Number.isNaN(start.getTime())) {
          return;
        }
        const end = new Date(start);
        end.setFullYear(end.getFullYear() + 1);
        const month = String(end.getMonth() + 1).padStart(2, '0');
        const day = String(end.getDate()).padStart(2, '0');
        endField.value = `${end.getFullYear()}-${month}-${day}`;
      };
      startField.addEventListener('change', syncEndDate);
      endField.addEventListener('input', function () {
        if (endField.value) {
          endField.dataset.userEdited = '1';
        } else {
          delete endField.dataset.userEdited;
          syncEndDate();
        }
      });
      syncEndDate();
    });
  </script>
{% endblock %}
{% block content %}
  <h1>Создание курса</h1>
  <form method="post" class="form-card">
    {% csrf_token %}
    {{ form.non_field_errors }}
    <div class="form-grid">
      <div class="form-column">
        <label for="{{ form.title.id_for_label }}">{{ form.title.label }}</label>
        {{ form.title }}
        {% if form.title.errors %}
          {% for error in form.title.errors %}<div class="form-error">{{ error }}</div>{% endfor %}
        {% endif %}

        <label for="{{ form.description.id_for_label }}">{{ form.description.label }}</label>
        {{ form.description }}
        {% if form.description.help_text %}<p class="help-text">{{ form.description.help_text }}</p>{% endif %}
        {% if form.description.errors %}
          {% for error in form.description.errors %}<div class="form-error">{{ error }}</div>{% endfor %}
        {% endif %}

        <label for="{{ form.teacher.id_for_label }}">{{ form.teacher.label }}</label>
        {{ form.teacher }}
        {% if form.teacher.errors %}
          {% for error in form.teacher.errors %}<div class="form-error">{{ error }}</div>{% endfor %}
        {% endif %}
      </div>
      <div class="form-column">
        <label for="{{ form.start_date.id_for_label }}">{{ form.start_date.label }}</label>
        {{ form.start_date }}
        {% if form.start_date.errors %}
          {% for error in form.start_date.errors %}<div class="form-error">{{ error }}</div>{% endfor %}
        {% endif %}

        <label for="{{ form.end_date.id_for_label }}">{{ form.end_date.label }}</label>
        {{ form.end_date }}
        {% if form.end_date.errors %}
          {% for error in form.end_date.errors %}<div class="form-error">{{ error }}</div>{% endfor %}
        {% endif %}

        <fieldset class="weekday-group">
          <legend>{{ form.schedule_days.label }}</legend>
          {{ form.schedule_days }}
          {% if form.schedule_days.help_text %}
            <p class="help-text">{{ form.schedule_days.help_text }}</p>
          {% endif %}
          {% if form.schedule_days.errors %}
            {% for error in form.schedule_days.errors %}<div class="form-error">{{ error }}</div>{% endfor %}
          {% endif %}
        </fieldset>
      </div>
    </div>
    <p><button class="btn" type="submit">Сохранить</button></p>
  </form>
{% endblock %}
